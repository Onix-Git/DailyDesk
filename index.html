<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DailyDesk</title>
<link rel="manifest" href="manifest.json">
<style>
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:#f4f6f8;color:#222;transition:background 0.3s,color 0.3s}
header{display:flex;justify-content:space-between;align-items:center;padding:16px;background:#111;color:#fff}
.app{display:flex;height:calc(100vh - 64px)}
.sidebar{width:200px;background:#1e1e1e;color:#fff}
.sidebar ul{list-style:none;padding:0;margin:0}
.sidebar li{padding:14px;cursor:pointer}
.sidebar li.active,.sidebar li:hover{background:#333}
.content{flex:1;padding:20px;overflow:auto}
.view{display:none}
.view.active{display:block}
button{padding:8px 12px;border:none;border-radius:6px;cursor:pointer;background:#4f46e5;color:#fff;transition:transform 0.2s}
button:hover{transform:scale(1.05)}
.list-item{display:flex;align-items:center;gap:10px;padding:8px;border-bottom:1px solid #ddd;opacity:0;animation:fadeIn 0.3s forwards;transition:all 0.3s}
.list-item input[type=checkbox]:checked + span{opacity:0.6;text-decoration:line-through;transform:scale(0.98)}
.form{margin:10px 0;display:flex;gap:8px;flex-wrap:wrap}
input,select,textarea{padding:8px;border-radius:6px;border:1px solid #ccc;transition:all 0.2s}
textarea{width:100%;height:150px}
.dark body{background:#111;color:#eee}
.dark header{background:#000}
.dark .sidebar{background:#000}
@keyframes fadeIn{to{opacity:1}}
</style>
</head>
<body>
<header>
<h1>DailyDesk</h1>
<button id="themeToggle">ðŸŒ™</button>
</header>

<div class="app">
<nav class="sidebar">
<ul>
<li class="active" data-view="dashboard">Dashboard</li>
<li data-view="tasks">TÃ¢ches</li>
<li data-view="routines">Routines</li>
<li data-view="notes">Notes</li>
<li data-view="stats">Stats</li>
</ul>
</nav>

<main class="content">
<section id="dashboard" class="view active">
<h2>Aujourdâ€™hui</h2>
<ul id="today"></ul>
</section>

<section id="tasks" class="view">
<h2>TÃ¢ches</h2>
<button onclick="toggleTaskForm()">Ajouter</button>
<div id="taskForm" class="form" style="display:none">
<input id="taskInput" placeholder="Nouvelle tÃ¢che">
<button onclick="addTask()">Enregistrer</button>
</div>
<ul id="taskList"></ul>
</section>

<section id="routines" class="view">
<h2>Routines</h2>
<button onclick="toggleRoutineForm()">Ajouter</button>
<div id="routineForm" class="form" style="display:none">
<input id="routineInput" placeholder="Nouvelle routine">
<select id="routineFreq">
<option value="daily">Tous les jours</option>
<option value="weekly">Toutes les semaines</option>
<option value="monthly">Tous les mois</option>
</select>
<button onclick="addRoutine()">Enregistrer</button>
</div>
<ul id="routineList"></ul>
</section>

<section id="notes" class="view">
<h2>Notes</h2>
<textarea id="notesInput"></textarea>
</section>

<section id="stats" class="view">
<h2>Statistiques</h2>
<p id="statsText"></p>
</section>
</main>
</div>

<script>
const now=()=>Date.now()
const day=86400000
const state=JSON.parse(localStorage.getItem("dailydesk"))||{tasks:[],routines:[],notes:"",theme:"light"}

const save=()=>localStorage.setItem("dailydesk",JSON.stringify(state))

const views=document.querySelectorAll(".view")
document.querySelectorAll(".sidebar li").forEach(l=>l.onclick=()=>{
views.forEach(v=>v.classList.remove("active"))
document.querySelectorAll(".sidebar li").forEach(x=>x.classList.remove("active"))
l.classList.add("active")
document.getElementById(l.dataset.view).classList.add("active")
})

function toggleTaskForm(){taskForm.style.display=taskForm.style.display==="none"?"flex":"none"}
function toggleRoutineForm(){routineForm.style.display=routineForm.style.display==="none"?"flex":"none"}

function addTask(){
if(!taskInput.value.trim())return
state.tasks.push({text:taskInput.value,done:false,doneAt:null})
taskInput.value=""
save();render()
}

function addRoutine(){
if(!routineInput.value.trim())return
state.routines.push({text:routineInput.value,done:false,freq:routineFreq.value,lastDone:null,streak:0})
routineInput.value=""
save();render()
}

function cleanupTasks(){state.tasks=state.tasks.filter(t=>!t.done||now()-t.doneAt<day)}
function resetRoutines(){
state.routines.forEach(r=>{
if(!r.lastDone)return
let interval=r.freq==="daily"?day:r.freq==="weekly"?day*7:day*30
if(now()-r.lastDone>=interval){r.done=false;r.lastDone=null}
})
}

function render(){
cleanupTasks();resetRoutines()
taskList.innerHTML="";routineList.innerHTML="";today.innerHTML=""

state.tasks.forEach((t,i)=>{
const li=document.createElement("li")
li.className="list-item"
const c=document.createElement("input")
c.type="checkbox";c.checked=t.done
c.onchange=()=>{t.done=c.checked;t.doneAt=now();save();render()}
const span=document.createElement("span");span.textContent=t.text
span.ondblclick=()=>{
const input=document.createElement("input");input.value=t.text
input.onkeydown=e=>{if(e.key==="Enter"){t.text=input.value;save();render()}}
li.innerHTML="";li.append(c,input)
input.focus()
}
const del=document.createElement("button");del.textContent="ðŸ—‘"
del.onclick=()=>{state.tasks.splice(i,1);save();render()}
li.append(c,span,del)
taskList.appendChild(li)
})

state.routines.forEach((r,i)=>{
const li=document.createElement("li")
li.className="list-item"
const c=document.createElement("input");c.type="checkbox";c.checked=r.done
c.onchange=()=>{
r.done=c.checked;r.lastDone=now()
if(r.done){
r.streak=(r.streak||0)+1
}else r.streak=0
save();render()
}
const span=document.createElement("span");span.textContent=`${r.text} (${r.freq}) ðŸ”¥${r.streak||0}`
span.ondblclick=()=>{
const input=document.createElement("input");input.value=r.text
input.onkeydown=e=>{if(e.key==="Enter"){r.text=input.value;save();render()}}
li.innerHTML="";li.append(c,input)
input.focus()
}
const del=document.createElement("button");del.textContent="ðŸ—‘"
del.onclick=()=>{state.routines.splice(i,1);save();render()}
li.append(c,span,del)
routineList.appendChild(li)
today.appendChild(li.cloneNode(true))
})

notesInput.value=state.notes
statsText.textContent=`TÃ¢ches complÃ©tÃ©es: ${state.tasks.filter(t=>t.done).length} | Routines complÃ©tÃ©es: ${state.routines.filter(r=>r.done).length}`
save()
}

notesInput.oninput=e=>{state.notes=e.target.value;save()}
themeToggle.onclick=()=>{
state.theme=state.theme==="light"?"dark":"light"
document.documentElement.className=state.theme
save()
}

document.documentElement.className=state.theme
render()

if('serviceWorker'in navigator){navigator.serviceWorker.register('sw.js')}
</script>
</body>
</html>
